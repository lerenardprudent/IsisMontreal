<!doctype html>
<html>
	
<head>
	
	<meta charset="UTF-8">
	<title>QUESTIONNAIRE ISIS</title>
	
	<link href = "http://fonts.googleapis.com/css?family=Open+Sans:400,300|Open+Sans+Condensed:300&subset=latin,latin-ext" rel = "stylesheet" type = "text/css" >
	<!--
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.0/themes/base/jquery-ui.css" type="text/css" />
	<link rel="stylesheet" href="objs/css/jslider.css" type="text/css" />
	-->
	<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/qtip2/2.1.0/jquery.qtip.min.js"></script>
	<!-- CSS file -->
	<link type="text/css" rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/qtip2/2.1.0/jquery.qtip.min.css" />
	<style>		
		.myCustomStyle  {
		   font-size: 12px
		}
		
		.tooltiptext{
			display: none;
		}
		
		.container {
			width: 40%;
			height: 40%;
			background: #444;
			margin: 0 auto;
		}
		.container img.wide {
			max-width: 100%;
			max-height: 100%;
			height: auto;
		}
		.container img.tall {
			max-height: 100%;
			max-width: 100%;
			width: auto;
		
		.inline-radio { display: inline-block; }
	</style>
	<style type="text/css" media="screen">
		html, body { width:100%; height:100%; }
		body { margin:0px; padding:0px; overflow:hidden; color:#404040; background-color:#f2f2f4; }
		a:link, a:visited { color:#dd0000; text-decoration:none; }
		a:active, a:hover { color:#404040; text-decoration:none; }
		input { background-color:#ffffff; margin:0px; padding:0px; border:1px solid #999; font-family:Arial, Helvetica, sans-serif; font-size:12px;}
		*:focus{ outline:none; }
		div { margin:0px; padding:0px; }
		select { background-color:#ffffff; margin:0px; padding:0px; border:1px solid #999; font-family:Arial, Helvetica, sans-serif; font-size:12px;}
		ul, ol {list-style-type:none; padding:0px; margin:0px; }
		li { background-color:#f4f4f4; padding:2px; text-overflow:ellipsis; white-space:nowrap; }
		li:nth-child(odd) { background-color:#fdfdfd; padding:2px; text-overflow:ellipsis; white-space:nowrap; }
		table, th, td { border-style:none; border-width:0px; border-collapse:collapse; padding:0px; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:12px; }
		th, td { height:24px; max-height:24px; }
		span { margin:0px; padding:0px; }
		#mainswf { position:absolute; left:0px; top:0px; width:100%; height:100%; font-family:Arial, Helvetica, sans-serif; font-size:12px;}
		#findtype { width:180px; } 
		#findrads { width:70px; } 
		#dragmain { height:60px; padding:2px }
		#infopanel { position:absolute; top:55px; left:0px; width:1900px; height:120px; padding:0px; background-color:#F2F2F4; text-wrap:none; white-space:nowrap; overflow:hidden; }
		#infolab1, #infolab2, #infolab3 { width:100px; color:#c0c0c0; text-wrap:none; white-space:nowrap; overflow:hidden; -webkit-user-select:none; -khtml-user-select:none; -moz-user-select:none; -o-user-select:none; user-select:none; }
		.ui-resizable-helper { border:1px dotted gray; }
		#mapdiv { position:absolute; top:170px; left:0px; width:1900px; height:690px; overflow:hidden; }
		#strviewdiv { position:absolute; top:175px; left:510px; width:500px; height:500px; overflow:hidden; visibility:hidden; border-width: 2px; border-style: outset; border-color: orange;  }
		#findspanel, #favspanel { position:absolute; left:1000px; top:200px; width: 200px; height:280px; padding:0px; border-style: none; background:#efefef; opacity:.9; font-family:Arial, Helvetica, sans-serif; font-size:11px; visibility:hidden; }
		#places, #objects { position:absolute; left:0px; top:20px; width:195px; height: 234px; border-style:solid; border-width:0px 1px 0px 1px; border-color:#999; padding-left:4px; overflow-x:hidden; overflow-y:scroll;}
		#panheadfinds, #panheadfavs { top:0px; width:199px; height:20px; margin:0px; padding:2px 0px 0px 0px; border-style:solid; border-width:1px 1px 0px 1px; border-color:#999; font-weight:bold; }
		#morefinds { position:absolute; top:255px; width:201px; height:25px; margin:0px; border-style:solid; border-width:0px 1px 1px 1px; border-color:#999; color:#dd0000; font-weight:bold; cursor: hand; cursor: pointer; }
		#favsmode { position:absolute; top:255px; width:194px; height:20px; margin:0px; border-style:solid; border-width:0px 1px 1px 1px; border-color:#999; padding:4px 0px 0px 6px;}
		#viewpanel { position:absolute; left:105px; top:115px; width:85px; height:220px; padding:15px; opacity:.9; border:1px solid #999; background:#efefef; font-family:Arial, Helvetica, sans-serif; font-size:11px; visibility:hidden; }
		#view1, #view2, #view3, #view4, #view5, #view6 { font-size:12px; font-weight:bold; } 
		#btn11, #btn12, #btn13, #btn14, #btn15, #btn16, #btn17, #btn18 { background-repeat:no-repeat; background-position:1px 1px; }
		#btn9 { position:absolute; top:8px; left:1860px; width:14px; height:14px;  background-repeat:no-repeat; background-position:-1px -1px; }
		#btn10 { position:absolute; top:8px; left:1880px; width:14px; height:14px;  background-repeat:no-repeat; background-position:-1px -1px; }
	</style>
	<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD4qnbkOe5X7pll7qyIFtkeLzjzkbPnAGo&amp;libraries=places,drawing,geometry,panoramio,weather&region=ca&sensor=false"></script>

	<script type="text/javascript" src="questionnaire_texte.json"></script>
	<script type="text/javascript" src="mousewheel.js"></script>
	<script type="text/javascript" src="promap.js"></script>
	
	<!--
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/jquery-migrate-1.1.1.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/ui/1.10.0/jquery-ui.js"></script>
	
	<script src="http://cdn.jquerytools.org/1.2.7/full/jquery.tools.min.js"></script>
	<script src="http://code.jquery.com/jquery-2.0.0.js"/>
	-->
	
	<script type="text/javascript" src="objs/tmpl.js"></script>
	<script type="text/javascript" src="objs/draggable-0.1.js"></script>
	<script type="text/javascript" src="objs/jshashtable-2.1_src.js"></script>
	
	<!--
	<script type="text/javascript" src="objs/jquery.dependClass-0.1.js"></script>
	<script type="text/javascript" src="objs/jquery.slider.js"></script>
	<script type="text/javascript" src="objs/jquery.numberformatter-1.2.3.js"></script>
	-->
	
	<link rel="stylesheet" type="text/css" media="all" href="objs/toolbar-js/jquery.toolbars.css">
	<link rel="stylesheet" type="text/css" media="all" href="objs/toolbar-js/bootstrap.icons.css">
	<script type="text/javascript" src="objs/toolbar-js/jquery.toolbar.min.js"></script>
	
	<script type="text/javascript" src="objs/wtooltip_latest.js"></script>
	<script>	
		function saveLocationToDB(marker)
		{
			_httpReqSaveLoc = new XMLHttpRequest();
			_httpReqSaveLoc.onreadystatechange=locSaveResp;
			var addr_shown = document.getElementById('address').value;
			var point_wkt = "point(" + marker.getPosition().lat().toFixed(8) + " " + marker.getPosition().lng().toFixed(8) + ")";
			var php_url = "reponses_bdd.php?up=in&id=" + _id_participant + "&q=" + _qno + "&t=" + _mode.nom + "&geo=" + encodeURI(point_wkt) + "&s=" + encodeURI(addr_shown);
			_httpReqSaveLoc.open("post",php_url,true);
			_httpReqSaveLoc.send();
		}
		
		function locSaveResp()
		{
			if (_httpReqSaveLoc.readyState==4 && _httpReqSaveLoc.status==200) {
				// Put some handling here?
			}
		}

	</script>
	<script type="text/javascript">
	
		var MODE_DESSIN = {
		  Point : {value: 0, nom: "point"}, 
		  Polygone: {value: 1, nom: "polygone"},
		  DomicileVerification: {value: 2, nom: "domver" }
		};
		var LANGUE = {
			Français : { val: "fr" },
			Anglais : { val: "an" }
		};

		var CODE_ERREUR = {
			PasUneErreur : { nom : 'nonerr', val : 0 },
			LangueErronnée : { nom : 'lang', val : 101 },
			AucunIdParticipant : { nom : 'idpart', val : 102 },
			AucunNumQuestion : { nom : 'numquest', val : 103 },
			NumQuestionInvalide : { nom : 'numquestinv', val : 104 },
			ModeDessinInvalide : { nom : 'modedessin', val : 105 },
			
			Inconnu : { nom : 'inconnu', val : 999 }
		};
		
		var _erreurs = { };
		_erreurs[CODE_ERREUR.LangueErronnée.nom] = 		{ 'fr' : "Langue n'est pas reconnue", 
														  'an': "Invalid language option" };
		_erreurs[CODE_ERREUR.AucunIdParticipant.nom] = 	{ 'fr' : "Aucun identifiant de participant n'est fourni",
														  'an': "No participant ID" };
		_erreurs[CODE_ERREUR.AucunNumQuestion.nom] = 	{ 'fr' : "Le numéro de question n'est pas spécifié.",
														  'an' : "The question number is missing." };
		_erreurs[CODE_ERREUR.NumQuestionInvalide.nom] = { 'fr' : "Le numéro de question n'est pas valide.",
														  'an' : "The question number is not valid." };
		_erreurs[CODE_ERREUR.ModeDessinInvalide.nom] = 	{ 'fr' : "Un mode de dessin configuré est invalide",
														  'an' : "A configured drawing mode is invalid" };
		_erreurs[CODE_ERREUR.Inconnu.nom] = 			{ 'fr' : "Erreur inconnue",
														  'an': "Unknown error" };	
		var _winbro;
		var _winw;		//window width
		var _winh;		//window height
		//var _sld;		//slider - timeline
		var _map;
		var _infowin;		//info window
		var _layerbike = null;		//layer bike om
		var _layertrans = null;		//layer transit on
		var _layertraff = null;		//layer traffic on
		var _strviewser;			//streetview service
		var _strviewpano;			//streetview panorama
		var _strviewon = false;		//street view flag;
		var _loca;		//location
		var _addr;		//address
		var _bnds;		//bounds
		var _drawman;			//drawing manager
		var _mapmark;		// mapclickmarker
		var _mapdrawpg = -1;		//markers loaded to map from current page on showmap.
		var _mapdata = "";			//all map objects
		var _editon = false;
		var _delobjon = false;		//delete flag in edit mode
		var _favobjects = [];		//my objects
		var _objcount = 0;		//object counter
		var _findmarkers = [];		//search results markers
		var _selobj; 		//selected object / shapes vars
		var _geocoder;		//geocoder
		var _serv;		//service
		var _currpg = 1;
		var _currcat = "";
		var _cats = [];
		var _maxfavs = 1;
		var _mode;
		var _question;
		var _consigne;
		var _langue = LANGUE.Français;
		var _id_participant;
		var _searchradius = 2000;
		var _qno;
		var _urlParams = {};
		var _qtip_text = "";
		var _qtip_title = "Questionnaire ISIS";
		var _httpReqSaveHome, _httpReqRespLookup, _httpReqHomeLookup, _httpReqSaveLoc, _httpReqSavePoly;
		var _lastGeocodedAddrComps = null;
		var _lastAddressText = null;
		var _lastPlaceIconClicked = null;
		var _drawnPolygon = null;
		var _geocodedSpecial = null;
		
		var tripiniconpath = "media/mapmark.png";
		
		$(document).ready( function()
		{
			$('img[id="helpicon"]').each(function() {
					$(this).qtip({
						content: {
							text: function(event, api) {
								// This time, we return the deferred object, not a 'Loading...' message.
								return $.ajax({
									url: 'dummy.htm'
								})
								.then(function(content) {
									// Return the content instead of using .set(). If you're wanting to select
									// specific elements, see ther above section and adapt the `api.set` call
									// into a `return elements` statement!
									api.set('content.title', _qtip_title);
									return _qtip_text
								}, function(xhr, status, error) {
									// Errors aren't handled by the library automatically, so
									// you'll need to call .set() upon failure, just as before.
									api.set('content.text', status + ': ' + error);
								});
							}
						},
						style: {
							classes: 'qtip-rounded myCustomStyle'
						}
					});
			});
			
			$("#address").keyup( function(event)
			{
				if (event.keyCode == 13) {
					$("#search_btn").click();
				}
			});
			
			_geocoder = new google.maps.Geocoder();
			parseUrl();
			if ( validerUrlParams() ) {
				document.getElementById('dash').style.visibility = "visible";
				var consigne, titre;
				if ( _langue == LANGUE.Français ) {
					titre = 'Questionnaire ISIS: Consigne pour répondre à cette question';
				}
				else {
					titre = 'ISIS Survey: How to answer this question';
				}
				popup_info_to_user(_consigne, 8, titre);
				mapinit();					
				inputs_init();
				
				if ( _mode == MODE_DESSIN.Polygone )
				{
					setDrawTools();
				}
				else {
					document.getElementById("drawbuttonsspan").innerHTML = ""; // Hide draw buttons
				}
				
				if ( _mode == MODE_DESSIN.DomicileVerification ) {
					var home_addr_encoded = getUrlParam('addr');
					if (home_addr_encoded != null) {
						var home_addr = decodeURI(home_addr_encoded);
						geocodeHomeAddress(home_addr);
					}
					else {
						puthomepin();
					}
				}
				else
				{
					puthomepin();
					init_map_pin_if_question_already_answered(_qno);
				}
			}
		});
		
		/*
		$(window).load(function(){
			 $('.container').find('img').each(function(){
			  var imgClass = (this.width/this.height > 1) ? 'wide' : 'tall';
			  $(this).addClass(imgClass);
			 })
		})
		*/
		
		String.prototype.trim = function() { return this.replace(/^\s+|\s+$/g,"");}
		String.prototype.ltrim = function() { return this.replace(/^\s+/,""); }
		String.prototype.rtrim = function() { return this.replace(/\s+$/,""); }
		
	</script>
	
</head>

<body onresize="resizebody();">
	<div id="mainswf">
	</div>
	
	<!-- PAGE LAYOUT STARTS HERE -->
	<div id="maindiv" class="maindivclass">
		<div id="dragmain" class="dragmain">
			<button id="btn9" type="button" title="Save" style="background-image:url(media/x-save.png);"></button>
			<button id="btn10" type="button" title="Fermer et retourner au questionnaire" style="background-image:url(media/x-close.png);"></button>
			<img src="media/logo_isis.jpg" style="background-color:#F2F2F4; vertical-align:middle; float:left" width="200" height="50px"/>
			<div id="user-options" class="toolbar-icons" style="display: none;">
			    <a id="outil1" href="#"><em class="icon-hand-up"></em></a>
			    <a id="outil2" href="#"><em class="icon-edit"></em></a>
			    <a id="outil3" href="#"><em class="icon-remove"></em></a>

		    </div>
		</div>
		<div id="titre">
			
		</div>
		<div id="mapdiv"></div>
		<div id="strviewdiv"></div>
		<div id="infopanel">
			<div id="questionpanel">
			</div>
			<table id="dash" style="visibility:hidden">
				<tr>
					<td>
						<span id="infolab1"><b>Recherche:&nbsp;&nbsp;&nbsp;</b></span>
					</td>
					<td>
						<input id="address" type="text" maxlength="150" style="width:450px; height:25px;" placeholder="-- Adresse ou mots-clés --" autofocus="autofocus"/>&nbsp;
						<button id="search_btn" style="background-color:#F2F2F4; height: 30px; width:30px; background-size: 30px 30px; background-repeat: no-repeat; display: inline-block; background-image:url(media/mag-glass.png); " type="button" title="Lancer une recherche" onclick="rechercher()"></button>
						<!-- <button id="btn3" type="button" value="U" title="Basculer la fenêtre qui offre une vue sur la rue localisée à l'adresse indiquée" onclick="togglestreetview();">Visualiser</button> -->
						<span id="drawbuttonsspan">
							<button id="btn_select_cursor" type="button" value="U"  onclick="stopDraw();" style="background-color:#F2F2F4; height: 30px; width:30px; background-size: 30px 30px; background-repeat: no-repeat; display: inline-block; background-image:url(media/cursor.png); " title="Confirmer l'adresse indiquée"></button>
							<button id="btn_draw_poly" type="button" value="D"  onclick="clickPoly();" style="background-color:#F2F2F4; height: 30px; width:30px; background-size: 30px 30px; background-repeat: no-repeat; display: inline-block; background-image:url(media/polygon.png); " title="Confirmer l'adresse indiquée"></button>
							<button id="btn_erase_poly" type="button" value="U"  onclick="clickEditDel();" style="background-color:#F2F2F4; height: 30px; width:30px; background-size: 30px 30px; background-repeat: no-repeat; display: inline-block; background-image:url(media/erase.png); " title="Confirmer l'adresse indiquée"></button>
						</span>
						<button id="btn_confirm" type="button" value="U"  onclick="confirmeraddress();" style="background-color:#F2F2F4; height: 30px; width:30px; background-size: 30px 30px; background-repeat: no-repeat; display: inline-block; background-image:url(media/tick.png); " title="Confirmer l'adresse indiquée"></button>
						<!-- <img id="drawicon" style="background-color:#F2F2F4; border:none; vertical-align:middle; visibility:hidden" src="media/pencil.png" width="30" height="30"/> -->
						<img id="helpicon" style="background-color:#F2F2F4; border:none; vertical-align:middle" src="media/Icon-information.svg" width="30" height="30"/>
						<!--<div class="tooltiptext">
							Pour situer le lieu en question, veuillez saisir son adresse en la tapant ou en l'indiquant directement avec une clique sur la carte ci-dessous. Une fois que le marqueur est correctement situé, veuillez sauvegarder votre sélection en appuyant sur le bouton <i>Confirmer</i>. Ensuite, pour fermer cette page et retourner au questionnaire, veuillez cliquer le bouton <i>X</i> en haut à droite.
						</div>-->
						<br/>
						<form>
					<input type="radio" id="radio_adresse" class="inline-radio" name="radioGroup" value="adresse" checked="checked" onclick="restoreAddressText();" autocomplete="off"/>
					<label  for="radio_adresse" class="inline-radio">Adresse&nbsp;&nbsp;</label>
					<input type="radio" id="radio_nom" class="inline-radio" name="radioGroup" value="nom_de_commerce" onclick="clearAddressField();" autocomplete="off"/>
					<label id="search_prox_label" for="radio_nom" class="inline-radio" disabled="true">Mots-clés</label>
				</form>
					</td>
				</tr>
				
				<!--
				<tr>
					<td>
						<span id="infolab2"><b>Recherche:</b></span>
					</td>
					<td>
						<select id="findtype"  title="Categories/types of places" style="width:150px; height:20px;" placeholder="Type">
							<option value=""></option>
							<option value="accounting">Accounting</option>
							<option value="airport">Airport</option>
							<option value="amusement_park">Amusement park</option>
							<option value="aquarium">Aquarium</option>
							<option value="art_gallery">Art gallery</option>
							<option value="atm">ATM</option>
							<option value="bakery">Bakery</option>
							<option value="bank">Bank</option>
							<option value="bar">Bar</option>
							<option value="beauty_salon">Beauty salon</option>
							<option value="bicycle_store">Bicycle store</option>
							<option value="book_store">Book store</option>
							<option value="bowling_alley">Bowling alley</option>
							<option value="bus_station">Bus station</option>
							<option value="cafe">Cafe</option>
							<option value="campground">Campground</option>
							<option value="car_dealer">Car dealer</option>
							<option value="car_rental">Car rental</option>
							<option value="car_repair">Car repair</option>
							<option value="car_wash">Car wash</option>
							<option value="casino">Casino</option>
							<option value="cemetery">Cemetery</option>
							<option value="church">Church</option>
							<option value="city_hall">City hall</option>
							<option value="clothing_store">Clothing store</option>
							<option value="convenience_store">Convenience store</option>
							<option value="courthouse">Courthouse</option>
							<option value="dentist">Dentist</option>
							<option value="department_store">Department store</option>
							<option value="doctor">Doctor</option>
							<option value="electrician">Electrician</option>
							<option value="electronics_store">Electronics store</option>
							<option value="embassy">Embassy</option>
							<option value="establishment">Establishment</option>
							<option value="finance">Finance</option>
							<option value="fire_station">Fire Station</option>
							<option value="florist">Florist</option>
							<option value="food">Food</option>
							<option value="funeral_home">Funeral home</option>
							<option value="furniture_store">Furniture store</option>
							<option value="gas_station">Gas station</option>
							<option value="general_contractor">General contractor</option>
							<option value="grocery_or_supermarket">Grocery or supermarket</option>
							<option value="gym">Gym</option>
							<option value="hair_care">Hair care</option>
							<option value="hardware_store">Hardware store</option>
							<option value="health">Health</option>
							<option value="hindu_temple">Hindu temple</option>
							<option value="home_goods_store">Home goods store</option>
							<option value="hospital">Hospital</option>
							<option value="insurance_agency">Insurance agency</option>
							<option value="jewelry_store">Jewelry store</option>
							<option value="laundry">Laundry</option>
							<option value="lawyer">Lawyer</option>
							<option value="library">Library</option>
							<option value="liquor_store">Liquor store</option>
							<option value="local_government_office">Local government office</option>
							<option value="locksmith">Locksmith</option>
							<option value="lodging">Lodging</option>
							<option value="meal_delivery">Meal delivery</option>
							<option value="meal_takeaway">Meal takeaway</option>
							<option value="mosque">Mosque</option>
							<option value="movie_rental">Movie rental</option>
							<option value="movie_theater">Movie theater</option>
							<option value="moving_company">Moving company</option>
							<option value="museum">Museum</option>
							<option value="night_club">Night club</option>
							<option value="painter">Painter</option>
							<option value="park">Park</option>
							<option value="parking">Parking</option>
							<option value="pet_store">Pet store</option>
							<option value="pharmacy">Pharmacy</option>
							<option value="physiotherapist">Physiotherapist</option>
							<option value="place_of_worship">Place of worship</option>
							<option value="plumber">Plumber</option>
							<option value="police">Police</option>
							<option value="post_office">Post office</option>
							<option value="real_estate_agency">Real estate agency</option>
							<option value="restaurant">Restaurant</option>
							<option value="roofing_contractor">Roofing contractor</option>
							<option value="rv_park">RV park</option>
							<option value="school">School</option>
							<option value="shoe_store">Shoe store</option>
							<option value="shopping_mall">Shopping mall</option>
							<option value="spa">Spa</option>
							<option value="stadium">Stadium</option>
							<option value="storage">Storage</option>
							<option value="store">Store</option>
							<option value="subway_station">Subway station</option>
							<option value="synagogue">Synagogue</option>
							<option value="taxi_stand">Taxi stand</option>
							<option value="train_station">Train station</option>
							<option value="travel_agency">Travel agency</option>
							<option value="university">University</option>
							<option value="veterinary_care">Veterinary care</option>
							<option value="zoo">Zoo</option>
						</select>
						<input id="findkwds" type="text" maxlength="150" style="width:200px; height:18px;" placeholder="Keywords" />
						<select id="findrads" style="width:70px; height:20px;">
							<option value="1000" selected>1 Km</option>
							<option value="2000">2 Km</option>
							<option value="3000">3 Km</option>
							<option value="4000">4 Km</option>
							<option value="5000">5 Km</option>
							<option value="7000">7 Km</option>
							<option value="10000">10 Km</option>
							<option value="15000">15 Km</option>
							<option value="20000">20 Km</option>
							<option value="25000">25 Km</option>
							<option value="30000">30 Km</option>
							<option value="35000">35 Km</option>
							<option value="40000">40 Km</option>
							<option value="45000">45 Km</option>
							<option value="50000">50 Km</option>
						</select>
						<button id="btn4" type="button" title="Search places on category or keywords inside the range." onclick='findplace()'>Find</button>
						<button id="btn5" type="button" title="Remove all search results." onclick='clearfindall();clearfindpanel()'>Clear</button>
					</td>			
				</tr>
				-->
				<tr id="drawtools">
					<td style="height:28px; max-height:28px; padding-top:5px;">
						<span id="infolab3"><b>Outils de dessin:&nbsp;&nbsp;</b></span>
					</td>
					<td style="height:28px; max-height:28px; padding-top:5px;">
						<!-- <button id="btn6" type="button" value="U" title="Toggle the marker/shape editor.">Edit</button> -->
						<span id="edittools" style="display:none;">
							<button id="btn11" type="button" style="background-image:url(media/cursor.png); padding:2px 6px 2px 6px;" title="Move the markers/shapes to a new position." onclick="stopDraw()">&nbsp;&nbsp;</button>
							<!-- <button id="btn12" type="button" style="background-image:url(media/tkico1.png); padding:2px 6px 2px 6px;" title="Create a new marker." onclick="clickMarker()">&nbsp;&nbsp;</button>
							<button id="btn13" type="button" style="background-image:url(media/tkico2.png); padding:2px 6px 2px 6px;" title="Create a circle shape." onclick="clickCirc()">&nbsp;&nbsp;</button>
							<button id="btn14" type="button" style="background-image:url(media/tkico3.png); padding:2px 6px 2px 6px;" title="Create a rectangular shape." onclick="clickRect()">&nbsp;&nbsp;</button> -->
							<button id="btn15" type="button" style="background-image:url(media/polygon.png); padding:2px 6px 2px 6px;" title="Create a poligon shape." onclick="clickPoly()">&nbsp;&nbsp;</button>
							<!-- <button id="btn16" type="button" style="background-image:url(media/tkico5.png); padding:2px 6px 2px 6px;" title="Create a polyline." onclick="clickLine()">&nbsp;&nbsp;</button> -->
							<button id="btn17" type="button" style="background-image:url(media/erase.png); padding:2px 6px 2px 6px;" title="Delete marker/shape." onclick="clickEditDel()">&nbsp;&nbsp;</button>
						</span>
						<!--<button id="btn7" type="button" title="Shows diferent map features and contents." onclick="toggleviewpanel();">View...</button> -->
						<!--<button id="btn8" type="button" title="Get the path betwen two places (markers only).">Directions</button> -->
					<!--	<span style="display:inline-block; width:240px; margin-left:5px;" id="timeline"><input id="slider" name="slider" value="720" />
							<script type="text/javascript">
								$("#slider").slider({ 
								from:0, 
								to:1440, 
								step:15, 
								dimension:'', 
								scale:['|','|','|','|','|'], 
								limits:true, 
								round:0,
								calculate:function( value ){ 
								var hours = Math.floor( value / 60 ); 
								var mins = ( value - hours*60 ); 
								return (hours < 10 ? "0"+hours : hours) + ":" + ( mins == 0 ? "00" : mins );
								}});
							</script>
						</span>-->
					</td>
				</tr>
			</table>
		</div>
		<div id="findspanel">
			<ol id="places"></ol>
			<div id="panheadfinds">&nbsp;&nbsp;Résultats de la recherche...
				<img id="findsclose" title="Effacer les résultats de la recherche" src="media/x-close.png" style="float:right; margin-right:2px; cursor:hand; cursor:pointer;" onclick="clearAllSearchResults();" />
			</div>
			<button id="morefinds" style="visibility:hidden" type="button">Plus de résultats...</button>
		</div>
		<div id="favspanel">
			<ol id="objects"></ol>
			<div id="panheadfavs">&nbsp;&nbsp;Favorites (my places)<img id="favsclose"  alt="Close favs" src="media/x-close.png" style="float:right; margin-right:2px; cursor:hand; cursor:pointer;" onclick="document.getElementById('favspanel').style.visibility = 'hidden'; document.getElementById('view1').checked = false;" /></div>
			<div id="favsmode"><input id="rfav1" type="radio" name="rfav" value="page" checked onclick="document.getElementById('view1').checked = true; document.getElementById('view2').checked = false; doview()" /> Current&nbsp;&nbsp;&nbsp;&nbsp;<input id="rfav2" type="radio" name="rfav" value="all" onclick="document.getElementById('view1').checked = true; document.getElementById('view2').checked = false; doview()" /> All</div>
		</div>
		<div id="viewpanel">
			<input type="checkbox" id="view1" name="view1" value="ppg" onclick="if(this.checked){ document.getElementById('view2').checked = false; }" /> Favorites<br/>
			<input type="checkbox" id="view2" name="view2" value="sea" onclick="if(this.checked){ document.getElementById('view1').checked = false; }" /> Search<br/><br/>
			<input type="checkbox" id="view3" name="view3" value="roa" checked onclick="if(this.checked){ document.getElementById('view4').checked = false; document.getElementById('view5').checked = false; document.getElementById('view6').checked = false; } else { document.getElementById('view3').checked = true; }" /> Roadmap<br/>
			<input type="checkbox" id="view4" name="view4" value="hyb" onclick="if(this.checked){ document.getElementById('view3').checked = false;document.getElementById('view5').checked = false; document.getElementById('view6').checked = false; } else { document.getElementById('view3').checked = true; }" /> Hybrid<br/>
			<input type="checkbox" id="view5" name="view5" value="sat" onclick="if(this.checked){ document.getElementById('view3').checked = false;document.getElementById('view4').checked = false; document.getElementById('view6').checked = false; } else { document.getElementById('view3').checked = true; }" /> Satellite<br/>
			<input type="checkbox" id="view6" name="view6" value="ter" onclick="if(this.checked){ document.getElementById('view3').checked = false;document.getElementById('view4').checked = false; document.getElementById('view5').checked = false; } else { document.getElementById('view3').checked = true; }" /> Terrain<br/><br/>
			<input type="checkbox" id="view7" name="view7" value="bic" /> Bicycle paths<br/>
			<input type="checkbox" id="view8" name="view8" value="tra" /> Transit map<br/>
			<input type="checkbox" id="view9" name="view9" value="trf" /> Traffic map<br/>
			<input type="checkbox" id="view10" name="view10" value="pan" /> Panoramio<br/><br/>
			<button id="btn20" type="button" style="height:18px; font-size:11px;" onclick="document.getElementById('viewpanel').style.visibility = 'hidden'; doview()">OK</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button id="btn21" type="button" style="height:18px; font-size:11px;" onclick="document.getElementById('viewpanel').style.visibility = 'hidden';">Cancel</button>
		</div>
	</div>

	
	<!-- PAGE LAYOUT ENDS HERE -->
	<script type="text/javascript">
		$(function(){
		  $('#drawicon').toolbar({
			  content: '#user-options',
			  position: 'bottom',
			  hideOnClick: true
		  });
		  $('#drawicon').on('toolbarItemClick', function(event, item){
			// when the user clicks an icon we call this function
			//console.dir(item);
			$(this).trigger('click');
				if ( item.id == 'outil1')
					stopDraw();
				else if ( item.id == 'outil2' )
					clickPoly();
				else if ( item.id == 'outil3')
					clickEditDel();
		  });
		  $('#drawicon').mouseover(function() { $(this).trigger('click'); });
		});
	</script>

	<script type="text/javascript">	
		var resizeTimer = 0;
		function resizebody()
		{
			if (resizeTimer){clearTimeout(resizeTimer);}
			resizeTimer = setTimeout(doresize, 500);
		}	
	
		function doresize()
		{
			onwindowsize();
		}
		
		function parseUrl()
		{
			var query = window.location.search.substring(1).split("&");
			for (var i = 0, max = query.length; i < max; i++)
			{
				if (query[i] === "") // check for trailing & with no param
					continue;

				var param = query[i].split("=");
				_urlParams[decodeURIComponent(param[0])] = decodeURIComponent(param[1] || "");
			}
		}
		
		function getUrlParam(key)
		{
			if ( typeof(_urlParams[key]) === 'undefined' )
				return null;
			return _urlParams[key];
		}
		
		function submitaddresshandler(e)
		{
			if (!e) e = window.event;
			var keyCode = e.keyCode || e.which;
			if (keyCode == '13'){
				rechercher();
			}
		}
		
		function popup_info_to_user(info, delay_sec, title)
		{
			_qtip_text = info;
			if ( title != null ) {
				_qtip_title = title;
			}
			$("#helpicon").mouseover();
			setTimeout("banishhelppopup();" , delay_sec*1000);
		}
		
		function banishhelppopup()
		{
			$("#helpicon").mouseleave();
		}
		
		function clearAddressField()
		{
			var addrField = document.getElementById("address");
			addrField.value = "";
			addrField.focus();
		}
		
		function validerUrlParams()
		{
			var questionpanel = document.getElementById('questionpanel');
			var style = "style=\"background-color:LightBlue; padding:5px\"";
			var content = null;
			var paramsValide = false;
			var errCode = lookForUrlErrors();
			
			if ( errCode == CODE_ERREUR.PasUneErreur ) {
				content = "<b>Question " + _qno + ": <i>" + _question + "</i><b>";
				paramsValide = true;
			}
			else {
				content = "<b><em>ERREUR:</em> " + returnErrorMsg(errCode) + "</b>";
			}
			questionpanel.innerHTML = "<p " + style + ">" + content + "</p>";
			return paramsValide;
		}
		
		function returnErrorMsg( errCode )
		{
			var err = errCode;
			if ( !(err.nom in _erreurs) ) {
				err = CODE_ERREUR.Inconnu;
			}
			return _erreurs[err.nom][_langue.val];
		}
		
		function lookForUrlErrors()
		{
			var langue = getUrlParam('langue');
			if ( langue != null ) {
				if (langue == LANGUE.Français.val ) {
					_langue = LANGUE.Français;
				}
				else if (langue == LANGUE.Anglais.val ) {
					_langue = LANGUE.Anglais;
				}
				else {
					return CODE_ERREUR.LangueErronnée;
				}
			}
			
			if ( getUrlParam('quest') == null ) {
				return CODE_ERREUR.AucuneNumQuestion;
			}
			
			var quest_no = getUrlParam('quest');
			for ( var i = 0; i < questionnaire_texte.length; i++ ) {
				var quest = questionnaire_texte[i];
				if (quest.question_no == quest_no) {
					if ( _langue == LANGUE.Anglais ) {
						_question = quest.question_an;
						_consigne = quest.consigne_an;
					}
					else {
						_question = quest.question_fr;
						_consigne = quest.consigne_fr;
					}
					var mode_dessin = quest.mode_dessin;
					if ( mode_dessin == MODE_DESSIN.Point.nom ) {
						_mode = MODE_DESSIN.Point;
					}
					else if ( mode_dessin == MODE_DESSIN.Polygone.nom ) {
						_mode = MODE_DESSIN.Polygone;
					}
					else if ( mode_dessin == MODE_DESSIN.DomicileVerification.nom ) {
						_mode = MODE_DESSIN.DomicileVerification;
					}
					else {
						return CODE_ERREUR.ModeDessinInvalide;
					}
					_qno = quest_no;
					break;
				}
			}
			if ( _question == null ) {
				return CODE_ERREUR.NumQuestionInvalide;
			}
			
			var particip_id = getUrlParam('pid');
			if ( particip_id == null || particip_id == "") {
				return CODE_ERREUR.AucunIdParticipant;
			}
				
			_id_participant = particip_id;	
			
			return CODE_ERREUR.PasUneErreur;
		}
		
	</script>
	
</body>

</html>